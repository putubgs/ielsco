generator client {
  provider = "prisma-client-js"
  engineType = "client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model admins {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email      String   @unique @db.VarChar(255)
  role       String   @default("admin") @db.VarChar(50)
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model careers {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title        String   @db.VarChar(255)
  slug         String   @unique @db.VarChar(255)
  description  String?
  requirements String?
  location     String?  @db.VarChar(255)
  remote       Boolean  @default(false)
  created_at   DateTime @default(now()) @db.Timestamptz(6)
}

model contact_messages {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String?  @db.VarChar(255)
  email      String?  @db.VarChar(255)
  subject    String?  @db.VarChar(255)
  message    String
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model event_registrations {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  event_id    String   @db.Uuid
  user_id     String?  @db.Uuid
  name        String?  @db.VarChar(255)
  email       String?  @db.VarChar(255)
  phone       String?  @db.VarChar(50)
  institution String?  @db.VarChar(255)
  metadata    Json?
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  events      events   @relation(fields: [event_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users       users?   @relation(fields: [user_id], references: [id], onUpdate: NoAction)

  @@index([event_id], map: "idx_event_reg_event")
  @@index([user_id], map: "idx_event_reg_user")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model events {
  id                  String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title               String                @db.VarChar(255)
  slug                String                @unique @db.VarChar(255)
  description         String?
  event_date          DateTime?             @db.Timestamptz(6)
  type                String?               @db.VarChar(50)
  banner_url          String?
  created_at          DateTime              @default(now()) @db.Timestamptz(6)
  event_registrations event_registrations[]

  @@index([event_date], map: "idx_events_date")
}

model feedback {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name       String?  @db.VarChar(255)
  email      String?  @db.VarChar(255)
  message    String
  metadata   Json?
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model membership_transactions {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String   @db.Uuid
  amount     Int
  currency   String   @default("IDR") @db.VarChar(10)
  method     String?  @db.VarChar(50)
  status     String   @default("pending") @db.VarChar(50)
  metadata   Json?
  created_at DateTime @default(now()) @db.Timestamptz(6)
  users      users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_membership_transactions_user")
}

model memberships {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String    @db.Uuid
  tier       String    @db.VarChar(50)
  start_date DateTime  @default(now()) @db.Timestamptz(6)
  end_date   DateTime? @db.Timestamptz(6)
  status     String    @default("active") @db.VarChar(50)
  created_at DateTime  @default(now()) @db.Timestamptz(6)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_memberships_user")
}

model otp_codes {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email      String   @db.VarChar(255)
  code_hash  String
  purpose    String   @default("signup") @db.VarChar(50)
  expires_at DateTime @db.Timestamptz(6)
  used       Boolean  @default(false)
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model resources {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title       String   @db.VarChar(255)
  description String?
  file_url    String?
  category    String?  @db.VarChar(50)
  created_at  DateTime @default(now()) @db.Timestamptz(6)
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model stories {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title      String   @db.VarChar(255)
  slug       String   @unique @db.VarChar(255)
  story      String?
  image_url  String?
  author     String?  @db.VarChar(255)
  created_at DateTime @default(now()) @db.Timestamptz(6)
}

model test_attempts {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id      String?       @db.Uuid
  test_id      String?       @db.Uuid
  started_at   DateTime      @default(now()) @db.Timestamptz(6)
  completed_at DateTime?     @db.Timestamptz(6)
  metadata     Json?
  tests        tests?        @relation(fields: [test_id], references: [id], onUpdate: NoAction)
  users        users?        @relation(fields: [user_id], references: [id], onUpdate: NoAction)
  test_scores  test_scores[]

  @@index([user_id], map: "idx_test_attempts_user")
}

model test_scores {
  id            String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  attempt_id    String        @db.Uuid
  listening     Decimal?      @db.Decimal
  reading       Decimal?      @db.Decimal
  writing       Decimal?      @db.Decimal
  speaking      Decimal?      @db.Decimal
  total         Decimal?      @db.Decimal
  created_at    DateTime      @default(now()) @db.Timestamptz(6)
  test_attempts test_attempts @relation(fields: [attempt_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([attempt_id], map: "idx_test_scores_attempt")
}

model tests {
  id            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String          @db.VarChar(100)
  type          String?         @db.VarChar(50)
  metadata      Json?
  created_at    DateTime        @default(now()) @db.Timestamptz(6)
  test_attempts test_attempts[]
}

model user_profiles {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id       String   @db.Uuid
  avatar_url    String?
  bio           String?
  occupation    String?  @db.VarChar(255)
  english_level String?  @db.VarChar(50)
  updated_at    DateTime @default(now()) @db.Timestamptz(6)
  users         users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model users {
  id                      String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email                   String                    @unique @db.VarChar(255)
  full_name               String?                   @db.VarChar(255)
  password_hash           String?
  user_id_code            String?                   @db.VarChar(100)
  last_seen               DateTime?                 @db.Timestamptz(6)
  created_at              DateTime                  @default(now()) @db.Timestamptz(6)
  event_registrations     event_registrations[]
  membership_transactions membership_transactions[]
  memberships             memberships[]
  test_attempts           test_attempts[]
  user_profiles           user_profiles[]
}
